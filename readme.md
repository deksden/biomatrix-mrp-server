# Алгоритм планирования ресурсов - MRP

Для работы алгоритма необходимо внесение следующих основных данных:

* **ресурсы**: материалы и сырье, которые используются в производстве продуктов
* **продукты**: перечень продукции, производство которой планируется
* **процессы**: схема производства продукции
* **начальные остатки ресурсов**: сколько ресурсов было на начало периода и сколько ресурсов находится в процессе доставки и прибудет несколько позднее начальной даты планирования
* **начальные остатки продукции**: сколько готовой продукции было на складе на начало периода, и какие партии продукции находятся в производстве на начало периода

## Ресурсы
 
Ресурсы - это материалы и сырье. Описание ресурса включает в себя:

* id: идентификатор ресурса
* caption: название ресурса
* unit: название единицы измерения ресурса
* minStock: минимальный остаток ресурсов, при котором заказывается следующая партия
* 

Методы:
* обработать ресурсы в транзите - сформировать регистр остаток ресурсов с учетом поступления 
ресурсов из транзита. Посмотреть остатки можно через ресурс "resource-stock"
* получить остатки ресурсов на определенную дату.
* сделать заказ сырья к определенной дате: получить срок размещения заказа


## Алгоритм

Обрабатываем ресурсы в транзите. Формируем регистр остатков ресурсов на определенные даты с учётом транзита.

Обрабатываем продукцию в производстве. Формируем регистр остатков продукции с учетом производства. Списываем
ресурсы на производство продукции.

Сортируем производственный план в хронологическом порядке. Обрабатываем каждую позицию 
производственного плана от самой ранней к самой поздней.

Берем текущую позицию производственного плана. Если остатки продукции на дату плана не 
соответствуют (менее минимальных остатков для этой продукции), то необходимо спланировать 
производство партии продукции.

Планирование партии продукции: на входе - дата готовности и количество. 
Берем описание процесса производства этой партии продукции. 
Сортируем в порядке следования прозводственных этапов, от самых первых к самым последним. 
Берем текущий этап. Производим вычисление даты начала этого этапа. Получаем список ресурсов, 
требуемых для данного этапа. Для каждого такого ресурса получаем остаток на дату начала 
производственного этапа. Производим расчет требуемого объема ресурсов для данного производственного
этапа. Если остатки ресурсов не позволяют начать этап, производим планирование поставки партии ресурсов.
Берём новые остатки ресурсов. 
Если остатки ресурсов позволяют произвести продукцию, сохраняем данные о себестоимости производства и 
фиксируем расход ресурсов на производство. 

Вычислить дату начала этапа: дата конечная, продукция, этап. Сортируем этапы хронологически. От самого 
последнего этапа начинаем. Отнимаем от даты конечной длительность текущего этапа. Если это требуемый этап -
возвращаем дату начала. Если этапы кончились - ошибка. Иначе - берем предшествующий этап.

Планирование поставки партии ресурсов: на входе - дата поступления ресурсов и требуемое количество. 
Справочно указываем основание заказа. Получаем длительность перевозки и изготовления требуемого 
ресурса для расчёта даты заказа. На эту дату 
получаем - какие условия поставки будут действовать. В соответствии с этими условиями записываем 
финансовые планы и требуемое количество ресурса для заказа. Записываем в список партий ресурсов эту партию
как заказанную (planned order). Основание заказа - продукция, этап. 

Получить остаток ресурсов на дату: берем перечень всех партий ресурсов в хронологическом 
порядке - от начальных остатков, остатков в транзите, и спланированных поставок. Далее получаем 
список всех расходных операций на дату. Соотносим приходные операции и расходные операции. Оставляем 
список всех партий, у которых остаток получился положительный - его и возвращем.

Списать ресурсы на призодство: продукция, этап, дата начала этапа. Берем список ресурсов, требуемый
для данного этапа. Для каждого ресурса берем текущий ресурс. Получаем остатки этого ресурса на дату. 
Делаем расчет требуемого количества ресурса на производство. Если ресурса не хватает - пишем об ошибке.
Если ресурса хватает, то для каждой партии ресурса на складе списываем имеющееся колчиество ресурсов 
из этой партии до тех пор, пока не наберем требуемое количество ресурсов.
   